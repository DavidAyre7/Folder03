<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <title>My Moltin App</title>
    <meta name="description" content="My Moltin App">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/styles.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/1.7.2/jquery.min.js"></script>
    <!-- <script type="text/javascript" src="js/moltin.js"></script> -->
    <script type="text/javascript" src="https://js.moltin.com/v1"></script>
  </head>

  <body>

    <div id="main">

      <div class="ready">
        <h1>You're ready to use Moltin!</h1>
        <p>You can now make API calls to the Moltin API, why not try getting your live products with the code below?</p>
        <pre><code class="javascript">
  moltin.Product.Search({status: 1}, function(products) {
    console.log(products);
  });
        </code></pre>
      </div>

      <p>Read the documentation and start building your JavaScript app:</p>

      <ul>
        <li><a href="https://moltin.com/getting-started/js">Moltin JavaScript Quickstart Guide</a></li>
        <li><a href="https://docs.molt.in">Moltin API Documentation</a></li>
      </ul>

    </div>

    <script type="text/javascript">

      var moltin = new Moltin({publicId: 'BXck1jw7RSRzciM80JBTfYa0KHXv5W5NTV4gb2D94A', notice: function(type, msg) { $('<div class="'+type+'">'+msg+'</div>').prependTo($('body')); } });
      moltin.Authenticate(function() {
        $('<div class="success">Authentication successful</div>').prependTo($('body'));
        $('.ready').show();
        // API calls here...

        // Extra code to list all live products
        moltin.Product.Search({status: 1}, function(products) {
          console.log(products);
        });

        // Extra code to retrieve information for "Test Prduct 1"
        console.log('A1');
        // Original code was var product = moltin.product.find({slug: 'test-product1-slug'});
        // Changed to :
        var product = moltin.Product.Find({slug: 'test-product1-slug'});

        // Extra code to add that product to the cart
        console.log('A2');
        console.log(product);
        console.log(product['id']);
        console.log('A2a');
        idx = product[0].depth;
        console.log(idx);
        console.log('A2b');
        console.log(42);

        var item = moltin.Cart.Insert(product['id'], 1, null);

        // Extra code to add that product to the cart a second time, giving a cart with two items
        console.log('A3');
        var item = moltin.Cart.Insert(product.id, 1, null);

        console.log('moltin structure');
        console.log(moltin);

        // Extra code to get cart contents
        console.log('A4');
        var cart = moltin.Cart.Contents();

        // Extra code to convert cart to order
        console.log('A5');
        var order = moltin.Cart.Complete({gateway: 'dummy'});

        // Extra code to process payment
        console.log('A6');
        console.log(order);
        var checkout = moltin.Checkout.Payment('purchase', order.id, {
          number:       '4242424242424242',
          expiry_month: '02',
          expiry_year:  '2017',
          cvv:          '123'
        });

        console.log('A7');

      });

    </script>
  </body>
</html>
